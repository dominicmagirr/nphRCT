sim_data$arm[sim_data$arm == "control"] <- "0"
sim_data$arm[sim_data$arm == "experimental"] <- "1"
head(sim_data)
#example setting t_star
#wlrt(formula=Surv(event_time,event_status)~group,
#     data=sim_data,
#     wlr="mw",
#     t_star = 4
#)
wlrt(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4
)
devtools::load_all()
#library(wlrt)
set.seed(1)
sim_data <- sim_events_delay(
n_c = 50,
n_e = 50,
delay_e = 6,
lambda_c = log(2)/9,
lambda_e_1 = log(2)/9,
lambda_e_2 = log(2)/18,
rec_period = 12,
rec_power = 1,
max_cal_t = 36
)
#example setting t_star
wlrt(formula=Surv(event_time,event_status)~group,
data=sim_data,
wlr="mw",
t_star = 4
)
### try changing names and see if it still works
colnames(sim_data) <- c("time", "event", "arm")
sim_data$arm[sim_data$arm == "control"] <- "0"
sim_data$arm[sim_data$arm == "experimental"] <- "1"
head(sim_data)
wlrt(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4
)
devtools::load_all()
#library(wlrt)
set.seed(1)
sim_data <- sim_events_delay(
n_c = 50,
n_e = 50,
delay_e = 6,
lambda_c = log(2)/9,
lambda_e_1 = log(2)/9,
lambda_e_2 = log(2)/18,
rec_period = 12,
rec_power = 1,
max_cal_t = 36
)
#example setting t_star
wlrt(formula=Surv(event_time,event_status)~group,
data=sim_data,
wlr="mw",
t_star = 4
)
### try changing names and see if it still works
colnames(sim_data) <- c("time", "event", "arm")
sim_data$arm[sim_data$arm == "control"] <- "0"
sim_data$arm[sim_data$arm == "experimental"] <- "1"
head(sim_data)
wlrt(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4
)
scores_1 <- find_scores(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4)
sum(scores_1$df[scores_1$df$group == "experimental","score"])
scores_1
sum(scores_1$df[scores_1$df$group == "1","score"])
plot(scores_1)
x
str(x$df$group)
str(scores_1$df$group)
devtools::load_all()
plot(scores_1)
set.seed(1)
sim_data <- sim_events_delay(
n_c = 50,
n_e = 50,
delay_e = 6,
lambda_c = log(2)/9,
lambda_e_1 = log(2)/9,
lambda_e_2 = log(2)/18,
rec_period = 12,
rec_power = 1,
max_cal_t = 36
)
#example setting t_star
wlrt(formula=Surv(event_time,event_status)~group,
data=sim_data,
wlr="mw",
t_star = 4
)
#example setting t_star
wlrt(formula=Surv(event_time,event_status)~group,
data=sim_data,
wlr="mw",
t_star = 4
)
#####################################################################
scores_1 <- find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
wlr="mw",
t_star = 4)
sum(scores_1$df[scores_1$df$group == "experimental","score"])
plot(scores_1)
devtools::load_all()
#library(wlrt)
set.seed(1)
sim_data <- sim_events_delay(
n_c = 50,
n_e = 50,
delay_e = 6,
lambda_c = log(2)/9,
lambda_e_1 = log(2)/9,
lambda_e_2 = log(2)/18,
rec_period = 12,
rec_power = 1,
max_cal_t = 36
)
#example setting t_star
wlrt(formula=Surv(event_time,event_status)~group,
data=sim_data,
wlr="mw",
t_star = 4
)
wlrt(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4
)
#####################################################################
scores_1 <- find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
wlr="mw",
t_star = 4)
sum(scores_1$df[scores_1$df$group == "experimental","score"])
plot(scores_1)
### try changing names and see if it still works
colnames(sim_data) <- c("time", "event", "arm")
sim_data$arm[sim_data$arm == "control"] <- "0"
sim_data$arm[sim_data$arm == "experimental"] <- "1"
head(sim_data)
wlrt(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4
)
scores_1 <- find_scores(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4)
sum(scores_1$df[scores_1$df$group == "1","score"])
plot(scores_1)
wlrt(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
s_star = 0.5
)
#example with 1 strata
sim_data_0 <- sim_data
sim_data_0$ecog=0
sim_data_1 <- sim_events_delay(
n_c = 50,
n_e = 50,
delay_e = 6,
lambda_c = log(2)/6,
lambda_e_1 = log(2)/6,
lambda_e_2 = log(2)/12,
rec_period = 12,
rec_power = 1,
max_cal_t = 36
)
sim_data_1$ecog=1
## rename
colnames(sim_data_1) <- c("time", "event", "arm", "ecog")
sim_data_1$arm[sim_data_1$arm == "control"] <- "0"
sim_data_1$arm[sim_data_1$arm == "experimental"] <- "1"
head(sim_data_1)
sim_data_strata<-rbind(sim_data_0,sim_data_1)
wlrt(formula=Surv(time,event)~arm+strata(ecog),
data=sim_data_strata,
wlr="mw",
t_star = 4
)
#example with 2 strata
sim_data_strata_2<-cbind(sim_data_strata,sex=rep(c("M","F"),times=100))
wlrt(formula=Surv(time,event)~arm+strata(ecog)+strata(sex),
data=sim_data_strata_2,
wlr="mw",
t_star = 4
)
sum(scores_1$df[scores_1$df$group == "experimental","score"])
sum(scores_1$df[scores_1$df$group == "1","score"])
wlrt(formula=Surv(time,event)~arm,
data=sim_data,
wlr="mw",
t_star = 4
)
N <- length(scores_1$df$t_j)
N
M_1 <- length(scores_1$df$t_j[scores_1$df$group == "1"])
M_1
a_bar <- mean(scores_1$df[,"score"])
a_bar
a_hat <- mean(scores_1$df[,"score"]^2)
a_hat
(N - M_1) * M_1 * (a_hat - a_bar ^ 2) / (N - 1)
template <- tempfile(fileext = ".xlsx")
GET(url = "https://static-content.springer.com/esm/art%3A10.1038%2Fs41591-018-0134-3/MediaObjects/41591_2018_134_MOESM3_ESM.xlsx", write_disk(template))
httr::GET(url = "https://static-content.springer.com/esm/art%3A10.1038%2Fs41591-018-0134-3/MediaObjects/41591_2018_134_MOESM3_ESM.xlsx", write_disk(template))
httr::GET(url = "https://static-content.springer.com/esm/art%3A10.1038%2Fs41591-018-0134-3/MediaObjects/41591_2018_134_MOESM3_ESM.xlsx", httr::write_disk(template))
getwd()
?tempfile
readxl::read_excel(template,
sheet = 3)
sim_data_pw <- readRDS("~/r-package-rct-under-anticipated-delayed-effects/tests/testthat/_snaps/sim_events_delay/sim_data_pw.RDS")
View(sim_data_pw)
set.seed(1)
sim_data <- sim_events_delay(
event_model=list(
duration_c = 36,
duration_e = c(6,30),
lambda_c = log(2)/9,
lambda_e = c(log(2)/9,log(2)/18)
),
recruitment_model=list(
rec_model="power",
rec_period = 12,
rec_power = 1
),
n_c=50,
n_e=50,
max_cal_t = 36
)
devtools::load_all()
sim_data <- sim_events_delay(
event_model=list(
duration_c = 36,
duration_e = c(6,30),
lambda_c = log(2)/9,
lambda_e = c(log(2)/9,log(2)/18)
),
recruitment_model=list(
rec_model="power",
rec_period = 12,
rec_power = 1
),
n_c=50,
n_e=50,
max_cal_t = 36
)
df_scores<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="mw",
t_star = 4
)
plot(df_scores)
df_scores
mean(df_scores$score)
mean(df_scores$df$score)
mean(df_scores$df$score[df_scores$df$group == "control"])
mean(df_scores$df$score[df_scores$df$group == "experimental"])
mean(df_scores$df$standardized_score[df_scores$df$group == "control"])
mean(df_scores$df$standardized_score[df_scores$df$group == "experimental"])
#############################################################################
find_pseudovalues(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 24)
#############################################################################
df_pvs_rmst <- find_pseudovalues(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 24)
plot(df_pvs_rmst)
set.seed(1)
sim_data <- sim_events_delay(
event_model=list(
duration_c = 36,
duration_e = c(6,30),
lambda_c = log(2)/9,
lambda_e = c(log(2)/9,log(2)/18)
),
recruitment_model=list(
rec_model="power",
rec_period = 12,
rec_power = 1
),
n_c=50,
n_e=50,
max_cal_t = 36
)
devtools::load_all()
set.seed(1)
sim_data <- sim_events_delay(
event_model=list(
duration_c = 36,
duration_e = c(6,30),
lambda_c = log(2)/9,
lambda_e = c(log(2)/9,log(2)/18)
),
recruitment_model=list(
rec_model="power",
rec_period = 12,
rec_power = 1
),
n_c=50,
n_e=50,
max_cal_t = 36
)
df_scores<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="mw",
t_star = 4
)
plot(df_scores)
library(survival)
library(ggplot2)
plot(df_scores)
mean(df_scores$score)
mean(df_scores$df$standardized_score[df_scores$df$group == "control"])
mean(df_scores$df$standardized_score[df_scores$df$group == "experimental"])
#############################################################################
df_pvs_rmst <- find_pseudovalues(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 24)
plot(df_pvs_rmst)
#############################################################################
df_pvs_rmst <- find_pseudovalues(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 33)
plot(df_pvs_rmst)
sim_data
plot(survfit(Surv(event_time, event_status)~group, data = sim_data))
plot(survfit(Surv(event_time, event_status)~group, data = sim_data), col = 1:2)
plot(survfit(Surv(event_time, event_status)~group, data = sim_data), col = 1:2)
plot(df_pvs_rmst)
devtools::document()
devtools::test()
set.seed(1)
sim_data <- sim_events_delay(
event_model=list(
duration_c = 36,
duration_e = c(6,30),
lambda_c = log(2)/9,
lambda_e = c(log(2)/9,log(2)/18)
),
recruitment_model=list(
rec_model="power",
rec_period = 12,
rec_power = 1
),
n_c=50,
n_e=50,
max_cal_t = 36
)
df_scores_mw<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="mw",
t_star = 4
)
df_scores_rmst<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 4
)
df_scores_ms<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="ms",
tau = 4
)
save_png <- function(code, width = 400, height = 400) {
path <- tempfile(fileext = ".png")
png(path, width = width, height = height)
on.exit(dev.off())
code
path
}
expect_snapshot_file(save_png(plot(df_scores_mw)), paste0("plot_mw.png"),cran = TRUE)
View(df_scores)
df_scores_mw <- readRDS("~/r-package-rct-under-anticipated-delayed-effects/tests/testthat/_snaps/find_scores/df_scores_mw.RDS")
df_scores_mw <- readRDS("~/r-package-rct-under-anticipated-delayed-effects/tests/testthat/_snaps/find_scores/df_scores_mw.RDS")
df_scores_ms <- readRDS("~/r-package-rct-under-anticipated-delayed-effects/tests/testthat/_snaps/find_scores/df_scores_ms.RDS")
View(df_scores_ms)
df_scores_rmst <- readRDS("~/r-package-rct-under-anticipated-delayed-effects/tests/testthat/_snaps/find_scores/df_scores_rmst.RDS")
devtools::test()
library(survival)
library(ggplot2)
devtools::test()
?devtools::test
devtools::find_active_file()
devtools::test_active_file()
devtools::test_file()
devtools::test_active_file()
set.seed(1)
sim_data <- sim_events_delay(
event_model=list(
duration_c = 36,
duration_e = c(6,30),
lambda_c = log(2)/9,
lambda_e = c(log(2)/9,log(2)/18)
),
recruitment_model=list(
rec_model="power",
rec_period = 12,
rec_power = 1
),
n_c=50,
n_e=50,
max_cal_t = 36
)
df_scores_mw<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="mw",
t_star = 4
)
df_scores_rmst<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 4
)
df_scores_ms<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="ms",
tau = 4
)
plot(df_scores_mw)
save_png(plot(df_scores_mw))
save_png <- function(code, width = 400, height = 400) {
path <- tempfile(fileext = ".png")
png(path, width = width, height = height)
on.exit(dev.off())
code
path
}
save_png(plot(df_scores_mw))
?expect_snapshot_file
expect_snapshot_file(save_png(plot(df_scores_mw)), paste0("plot_mw.png"),cran = TRUE)
devtools::test()
devtools::test()
devtools::test()
devtools::test()
expect_snapshot_file(save_png(plot(df_scores_mw)),"plot_mw.png", cran = TRUE)
snapshot_review()
devtools::load_all()
testthat::test_file("tests/testthat/test-find_scores.R")
testthat::test_file("tests/testthat/test-find_scores.R")
testthat::test_file("tests/testthat/test-find_scores.R")
library(survival)
library(ggplot2)
set.seed(1)
sim_data <- sim_events_delay(
event_model=list(
duration_c = 36,
duration_e = c(6,30),
lambda_c = log(2)/9,
lambda_e = c(log(2)/9,log(2)/18)
),
recruitment_model=list(
rec_model="power",
rec_period = 12,
rec_power = 1
),
n_c=50,
n_e=50,
max_cal_t = 36
)
df_scores<-find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="mw",
t_star = 4
)
plot(df_scores)
mean(df_scores$df$standardized_score[df_scores$df$group == "control"])
mean(df_scores$df$standardized_score[df_scores$df$group == "experimental"])
#############################################################################
df_pvs_rmst <- find_pseudovalues(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 33)
plot(df_pvs_rmst)
df_pvs_rmst
class(df_pvs_rmst)
#############################################################################
df_pvs_rmst <- find_scores(formula=Surv(event_time,event_status)~group,
data=sim_data,
method="rmst",
tau = 33)
plot(df_pvs_rmst)
plot(df_scores)
plot(df_pvs_rmst)
mean(df_scores$df$standardized_score[df_scores$df$group == "control"])
mean(df_scores$df$standardized_score[df_scores$df$group == "experimental"])
mean(df_pvs_rmst$df$standardized_score[df_pvs_rmst$df$group == "control"])
mean(df_pvs_rmst$df$standardized_score[df_pvs_rmst$df$group == "experimental"])
plot(survfit(Surv(event_time, event_status)~group, data = sim_data), col = 1:2)
devtools::check()
